{% extends "base.html" %}
{% block title %}Profile Page{% endblock %}
{% block content %}

<div class="container mt-5">
  <div class="row g-4 flex-column flex-lg-row">

    <!-- Profile Card: Sticky on scroll -->
    <div class="col-lg-4">
      <div class="position-sticky" style="top: 80px;">
        <div class="card shadow-sm p-4">
          <div class="text-center mb-3">
            <img src="{{ user.profile_picture }}"
                 class="rounded-circle img-fluid"
                 style="width: 130px; height: 130px;" alt="avatar">
          </div>

          <!-- Reset Button -->
          <form method="POST" action="{{ url_for('users.reset_profile_picture') }}">
            {{ form.csrf_token }}
            <button type="submit" class="btn btn-outline-danger w-100" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Use only if you want to reset to your original picture after uploading another.">Reset Picture</button>
          </form>

          <!-- Centered DiceBear Tip -->
          <div class="small text-muted mt-3 text-center">
            Image Source <br>
            <a href="https://www.dicebear.com/playground/" target="_blank"> DiceBear</a>
          </div>

          <hr class="my-4">

          <!-- Edit Info Form -->
          <form method="POST">
            {{ form.hidden_tag() }}

            <div class="mb-3">
              <label class="form-label">Username</label>
              {{ form.username(class="form-control", value=user.username) }}
            </div>

            <div class="mb-3">
              <label class="form-label">Email</label>
              {{ form.email(class="form-control", value=user.email) }}
            </div>

            <div class="d-grid gap-2">
              {{ form.submit(class="btn btn-success") }}
            <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
              Delete Account
            </button>

            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Posts Section -->
    <div class="col-lg-8">
      <div class="text-center mb-4">
        <h3 class="text-primary ">YOUR POSTS</h3>
        <hr class="w-25 mx-auto">
      </div>

      {% if posts %}
        {% for post in posts %}
          {% set liked = post.likes | selectattr("user_id", "equalto", current_user.id) | list | length > 0 %}
          {% set edit = True %}
          {% include "_post_card.html" %}
        {% endfor %}
      {% else %}
        <div class="container mt-5">
          <div class="alert alert-primary text-center" role="alert">
            <h4 class="alert-heading">No Posts Found!</h4>
            <p>It seems you haven't created any posts yet. Start jotting down your thoughts!</p>
            <hr>
            <p class="mb-0">Click the button below to create your first note.</p>
            <a href="{{ url_for('posts.create_post') }}" class="btn btn-primary mt-3">Create Post</a>
          </div>
        </div>
      {% endif %}
    </div>

  </div>
</div>

<!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form method="POST" action="{{ url_for('users.delete_account') }}">
        {{ form.csrf_token }}
        <div class="modal-header">
          <h5 class="modal-title" id="deleteAccountModalLabel">Confirm Account Deletion</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete your account? This action cannot be undone.
        </div>
        <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <input type="submit" class="btn btn-danger" value="Delete">
      </div>

      </form>
    </div>
  </div>
</div>



{% block like_script %}{% endblock %}
{% endblock %}
