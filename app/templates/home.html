{% extends "base.html" %}
{% block title %}Home - StoryCloak{% endblock %}

{% block content %}
<style>
  /* Fixed Sidebar (Desktop) */
  @media (min-width: 992px) {
    aside {
      position: sticky;
      top: 80px;
      height: calc(100vh - 80px);
      overflow-y: auto;
    }
  }

  /* Sidebar link hover */
  .sidebar-link:hover {
    background-color: #eef5ff;
    border-radius: 5px;
    padding-left: 5px;
    transition: all 0.2s ease;
  }

  .sidebar-card {
    font-size: 0.95rem;
    padding: 0.25rem;
  }

  .article-card {
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .article-card .card-body {
    flex-grow: 1;
  }

  @media (max-width: 991.98px) {
    .offcanvas-start {
      width: 260px !important;
    }

    .offcanvas-body .sidebar-link {
      font-size: 1.1rem;
      display: block;
      padding: 12px 0;
      margin-bottom: 6px;
      color: #0d6efd;
      transition: background-color 0.2s ease;
    }

    .offcanvas-body .sidebar-link:hover {
      background-color: #e8f0ff;
      padding-left: 8px;
      border-radius: 6px;
    }

    .offcanvas-body strong {
      display: block;
      margin-top: 20px;
      margin-bottom: 10px;
      font-size: 1.15rem;
    }
  }

.outline-humor     { border-color: #e7c367c6; }
.outline-tips      { border-color: #62df64c6; }
.outline-reviews   { border-color: #451919c6; }
.outline-personal  { border-color: #c54faac6; }
.outline-none      { border-color: #6c757d; }
.outline-tech      { border-color: hsl(241, 83%, 48%); }

.bg-humor     { background-color: #e7c367c6; }
.bg-tips      { background-color: #62df64c6; }
.bg-reviews   { background-color: #451919c6; }
.bg-personal  { background-color: #c54faac6; }
.bg-none      { background-color: #6c757d; }
.bg-tech      { background-color: hsl(241, 86%, 55%); }
article[class^="outline-"],
.card[class^="outline-"] {
  border-left: 6px solid;
  padding-left: 1rem;
  background-color: #fff;
  border-radius: 5px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  transition: border-color 0.3s ease;
}

</style>

<!-- Mobile Hamburger Menu -->
<div class="container py-3 d-lg-none">
  <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu">
    <i class="bi bi-list"></i> Menu
  </button>
</div>

<!-- Offcanvas Sidebar (Mobile) -->
<div class="offcanvas offcanvas-start d-lg-none" tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
  <div class="offcanvas-header bg-primary text-white">
    <h5 class="offcanvas-title" id="sidebarMenuLabel">Explore</h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <div class="list-group p-3">

      <!-- a tag styled as a button -->
      <a href="{{ url_for('posts.trending') }}" class="btn btn-sm btn-outline-primary w-100 text-start mb-2">
        <i class="bi bi-graph-up me-2"></i> <b>Trending</b>
      </a>

         <a href="{{ url_for('posts.latest_posts') }}" class="btn btn-sm btn-outline-primary w-100 text-start mb-2">
        <i class="bi bi-graph-up me-2"></i> <b>Latest</b>
      </a>


      <strong class="text-dark mt-3 d-block"><i class="bi bi-folder me-2"></i> Categories</strong>

      <!-- categories as a tags -->
      <a href="{{ url_for('posts.humor') }}" class="btn btn-sm btn-outline-humor bg-humor w-100 text-start mb-2">
        <i class="bi bi-emoji-laughing me-2"></i> <b>Humours</b>
      </a>
      <a href="{{ url_for('posts.tips') }}" class="btn btn-sm btn-outline-tips bg-tips w-100 text-start mb-2">
        <i class="bi bi-emoji-smile me-2"></i> <b>Tips</b>
      </a>

      <!-- categories as buttons -->
      <a href="{{ url_for('posts.reviews') }}" class="btn btn-sm btn-outline-reviews bg-reviews w-100 text-start mb-2">
        <i class="bi bi-hand-thumbs-up me-2"></i> <b>Reviews</b>
      </a>
      <a href="{{ url_for('posts.personal') }}" class="btn btn-sm btn-outline-personal bg-personal w-100 text-start mb-2">
        <i class="bi bi-heart me-2"></i> <b>Personal</b>
      </a>
      <a href="{{ url_for('posts.tech') }}" class="btn btn-sm btn-outline-tech bg-tech w-100 text-start mb-2">
        <i class="bi bi-cpu me-2"></i> <b>Tech</b>
      </a>
      <a href="{{ url_for('posts.none') }}" class="btn btn-sm btn-outline-none bg-none w-100 text-start mb-2">
        <i class="bi bi-question-circle me-2"></i> <b>None</b>
      </a>
      <a href="{{ url_for('posts.all') }}" class="btn btn-sm btn-outline-secondary w-100 text-start mb-2">
        <i class="bi bi-list-ul me-2"></i> <b>All Posts</b>
      </a> 
      <!-- profile as an a tag button -->
      <a href="{{ url_for('users.profile') }}" class="btn btn-sm btn-outline-dark w-100 text-start">
        <i class="bi bi-person me-2"></i> <b>Profile</b>
      </a>

    </div>
  </div>
</div>

<!-- Main Layout -->
<div class="container">
  <div class="row">

    <!-- Desktop Sidebar -->
    <aside class="col-lg-3 d-none d-lg-block">
  <div class="card sidebar-card shadow-sm border-primary-subtle mb-4">
    <div class="card-header bg-primary text-white">
      <strong>Explore</strong>
    </div>
    <div class="list-group p-3">

      <!-- a tag styled as a button -->
      <a href="{{ url_for('posts.trending') }}" class="btn btn-sm btn-outline-primary w-100 text-start mb-2">
        <i class="bi bi-graph-up me-2"></i> <b>Trending (Top 7)</b>
      </a>

         <a href="{{ url_for('posts.latest_posts') }}" class="btn btn-sm btn-outline-primary w-100 text-start mb-2">
        <i class="bi bi-graph-up me-2"></i> <b>Latest</b>
      </a>


      <strong class="text-dark mt-3 d-block"><i class="bi bi-folder me-2"></i> Categories</strong>

      <!-- categories as a tags -->
      <a href="{{ url_for('posts.humor') }}" class="btn btn-sm btn-outline-humor bg-humor w-100 text-start mb-2 ">
        <i class="bi bi-emoji-laughing me-2"></i> <b>Humours</b>
      </a>
      <a href="{{ url_for('posts.tips') }}" class="btn btn-sm btn-outline-tips bg-tips w-100 text-start  mb-2">
        <i class="bi bi-emoji-smile me-2"></i> <b>Tips</b>
      </a>

      <!-- categories as buttons -->
      <a href="{{ url_for('posts.reviews') }}" class="btn btn-sm btn-outline-reviews bg-reviews w-100  text-start mb-2 ">
        <i class="bi bi-hand-thumbs-up me-2"></i> <b>Reviews</b>
      </a>
      <a href="{{ url_for('posts.personal') }}" class="btn btn-sm btn-outline-personal bg-personal w-100 text-start   mb-2">
        <i class="bi bi-heart me-2"></i> <b>Personal</b>
      </a>

      <a href="{{ url_for('posts.tech') }}" class="btn btn-sm btn-outline-tech bg-tech w-100 text-start mb-2">
        <i class="bi bi-heart me-2"></i> <b>Tech</b>
      </a> 
      <a href="{{ url_for('posts.none') }}" class="btn btn-sm btn-outline-none bg-none w-100 text-start mb-2">
        <i class="bi bi-question-circle me-2"></i> <b>None</b>
      </a>
      <a href="{{ url_for('posts.all') }}" class="btn btn-sm btn-outline-secondary w-100 text-start mb-2">
        <i class="bi bi-list-ul me-2"></i> <b>All Posts</b>
      </a> 

      <!-- profile as an a tag button -->
      <a href="{{ url_for('users.profile') }}" class="btn btn-sm btn-outline-dark w-100 text-start">
        <i class="bi bi-person me-2"></i> <b>Profile</b>
      </a>

    </div>
  </div>
</aside>

    <!-- Articles Section -->
    <main class="col-12 col-lg-9 mt-4">
      {% for post in posts %}
      {% set liked = post.likes | selectattr("user_id", "equalto", current_user.id) | list | length > 0 %}
      {% include "_post_card.html" %}
      
{% block like_script %}
{% endblock %}



      {% endfor %}
    </main>


  </div>
</div>
{% if posts.has_prev or posts.has_next %}
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center m-4">
    <li class="page-item {% if not posts.has_prev %}disabled{% endif %}">
      <a class="page-link" href="{% if posts.has_prev %}{{ url_for('main.home', page=posts.prev_num) }}{% else %}#{% endif %}" tabindex="-1">Previous</a>
    </li>
    
    {% for page_num in posts.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
      {% if page_num %}
        <li class="page-item {% if posts.page == page_num %}active{% endif %}">
          <a class="page-link" href="{{ url_for('main.home', page=page_num) }}">{{ page_num }}</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">â€¦</span></li>
      {% endif %}
    {% endfor %}
    
    <li class="page-item {% if not posts.has_next %}disabled{% endif %}">
      <a class="page-link" href="{% if posts.has_next %}{{ url_for('main.home', page=posts.next_num) }}{% else %}#{% endif %}">Next</a>
    </li>
  </ul>
</nav>
{% endif %}
{% endblock %}
